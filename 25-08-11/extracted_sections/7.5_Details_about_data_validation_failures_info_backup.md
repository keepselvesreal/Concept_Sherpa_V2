# 추가 정보

## 핵심 내용
JSON Schema 검증이 실패했을 때, 단순히 유효/무효 판정뿐만 아니라 실패 원인에 대한 상세 정보를 얻을 수 있습니다. Ajv 라이브러리에서는 `ajv.errors` 배열을 통해 누락된 필드명, 타입 불일치 등의 구체적인 오류 정보를 제공하며, `errorsText()` 함수로 사람이 읽기 쉬운 형태로 변환할 수 있습니다. 기본적으로는 첫 번째 오류만 잡지만 `allErrors: true` 옵션을 사용하면 모든 검증 오류를 동시에 확인할 수 있습니다.

## 상세 핵심 내용
### JSON Schema 데이터 검증 실패 상세 정보 처리

이 섹션에서는 JSON Schema 검증이 단순히 성공/실패의 이진적 결과가 아니라, 실패 시 구체적인 실패 원인에 대한 상세 정보를 제공할 수 있음을 설명합니다.

### 검증 실패 정보의 필요성

**기본 개념**: 데이터가 유효하지 않을 때, 단순히 실패했다는 정보만으로는 부족합니다. 실제로는 다음과 같은 구체적인 정보가 필요합니다:
- 어떤 필수 필드가 누락되었는지
- 어떤 필드가 예상된 타입과 다른지
- 구체적으로 어떤 검증 규칙을 위반했는지

### Ajv 라이브러리에서의 검증 오류 처리

#### 기본 오류 정보 접근 방법

```javascript
var searchBooksRequestSchema = {
    "type": "object",
    "properties": {
        "title": {"type": "string"},
        "fields": {
            "type": "array",
            "items": {"type": "string"}
        }
    },
    "required": ["title", "fields"]
};

var invalidSearchBooksRequest = {
    "myTitle": "habit",  // 'title' 대신 'myTitle' 사용 (오류)
    "fields": ["title", "weight", "number_of_pages"]
};

var ajv = new Ajv();
ajv.validate(searchBooksRequestSchema, invalidSearchBooksRequest);
ajv.errors // 검증 오류 배열에 접근
```

#### 오류 정보의 구조

검증 실패 시 반환되는 오류 객체의 구조:

```javascript
[
    {
        "instancePath": "",                    // 오류 발생 위치 경로
        "schemaPath": "#/required",           // 스키마 내 해당 규칙 경로
        "keyword": "required",                // 위반된 키워드
        "params": {
            "missingProperty":"title"         // 구체적인 오류 매개변수
        },
        "message": "must have required property 'title'"  // 오류 메시지
    }
]
```

### 사용자 친화적 오류 메시지 변환

**errorsText 유틸리티 함수**:
```javascript
ajv.errorsText(ajv.errors);
// → "data must have required property 'title'"
```

이 함수는 복잡한 오류 객체 배열을 사람이 읽기 쉬운 텍스트 형태로 변환합니다.

### 다중 검증 오류 처리

#### 기본 동작의 한계
- **기본적으로 Ajv는 첫 번째 검증 오류만 감지**합니다
- 성능상의 이유로 첫 오류 발견 시 검증을 중단합니다

#### allErrors 옵션 활용

```javascript
// 다중 오류가 있는 데이터
var invalidSearchBooksRequest = {
    "myTitle": "habit",     // 오류 1: 'title' 필드 누락
    "fields": [1, 2]        // 오류 2,3: 배열 요소가 문자열이 아님
};

// allErrors: true 옵션으로 모든 오류 감지
var ajv = new Ajv({allErrors: true});
ajv.validate(searchBooksRequestSchema, invalidSearchBooksRequest);

ajv.errorsText(ajv.errors);
// → "data must have required property 'title',
// → data/fields/0 must be string,
// → data/fields/1 must be string"
```

이 설정을 통해 한 번의 검증으로 모든 오류를 확인할 수 있습니다.

### JSON Schema 치트 시트

#### 기본 스키마 구조 예제

```javascript
{
    "type": "array",                    // 루트 레벨: 배열
    "items": {
        "type": "object",               // 각 배열 요소: 객체
        "properties": {
            "myNumber": {"type": "number"},              // 숫자 타입
            "myString": {"type": "string"},              // 문자열 타입
            "myEnum": {"enum": ["myVal", "yourVal"]},    // 열거형 (두 값 중 선택)
            "myBool": {"type": "boolean"}                // 불린 타입
        },
        "required": ["myNumber", "myString"],    // 필수 필드 지정
        "additionalProperties": false            // 명시되지 않은 추가 속성 금지
    }
}
```

#### 유효한 데이터 예제

```javascript
[
    {
        // 모든 필드가 유효한 완전한 객체
        "myNumber": 42,
        "myString": "Hello",
        "myEnum": "myVal",
        "myBool": true
    },
    {
        // 필수 필드만 포함된 유효한 객체 (선택적 필드 생략 가능)
        "myNumber": 54,
        "myString": "Happy"
    }
]
```

### 실무 적용 시사점

#### 웹 서버 환경에서의 활용
- **API 요청 검증**: 클라이언트에서 전송된 데이터의 상세한 검증 결과 제공
- **사용자 경험 개선**: 구체적인 오류 정보를 통해 클라이언트가 정확히 어떤 부분을 수정해야 하는지 안내
- **디버깅 효율성**: 개발 과정에서 데이터 구조 문제를 빠르게 식별하고 해결

#### 라이브러리별 차이점 고려사항
- 각 JSON Schema 검증 라이브러리마다 오류 정보를 노출하는 방식이 다름
- Ajv의 경우 `errors` 배열과 `errorsText()` 함수 제공
- 다른 라이브러리 사용 시 해당 라이브러리의 오류 처리 방식 확인 필요

이러한 상세한 검증 오류 정보 처리 기능을 통해 시스템의 경계에서 보다 정교하고 사용자 친화적인 데이터 검증을 구현할 수 있습니다.

## 주요 화제
### 주요 화제 분석

- **JSON Schema 검증 실패 상세 정보 추출**: 데이터가 유효하지 않을 때 단순히 실패 여부만이 아니라 실패 원인에 대한 구체적인 정보(필수 필드 누락, 타입 불일치 등)를 얻을 수 있는 방법

- **Ajv 라이브러리의 오류 처리 메커니즘**: JavaScript Ajv 라이브러리에서 검증 실패 시 validator 인스턴스 내부의 errors 배열에 오류 정보가 저장되는 구조와 활용법

- **다중 검증 오류 처리**: 기본적으로 첫 번째 오류만 감지하는 Ajv를 allErrors 옵션을 통해 모든 검증 실패를 동시에 포착하는 방법

- **오류 정보의 사용자 친화적 변환**: errorsText 유틸리티 함수를 사용하여 복잡한 오류 배열을 사람이 읽기 쉬운 형태로 변환하는 기법

- **JSON Schema 설계 패턴과 실제 적용**: 객체 타입, 배열, 속성 정의, 필수 필드 지정, 열거형 값 등을 포함한 실용적인 스키마 작성 방법과 유효한 데이터 예시

## 부차 화제
- JSON Schema 검증 실패 상세 정보 접근: 데이터가 유효하지 않을 때 실패 이유에 대한 구체적인 세부사항을 얻는 방법
- Ajv 라이브러리의 오류 처리 메커니즘: JavaScript Ajv에서 검증 오류가 배열 형태로 validator 인스턴스에 저장되는 방식
- 단일 검증 실패 사례 분석: 필수 필드가 누락되었을 때 오류 정보의 구조와 내용
- 오류 정보의 가독성 향상: errorsText 유틸리티 함수를 사용하여 오류 배열을 인간이 읽기 쉬운 형태로 변환하는 방법
- 다중 검증 실패 처리: allErrors 옵션을 사용하여 여러 검증 오류를 한 번에 포착하는 방법
- JSON Schema 치트 시트: 다양한 데이터 타입과 검증 규칙을 포함한 JSON Schema 작성 가이드
- 유효한 데이터 예제: JSON Schema에 부합하는 올바른 데이터 구조의 실제 사례
