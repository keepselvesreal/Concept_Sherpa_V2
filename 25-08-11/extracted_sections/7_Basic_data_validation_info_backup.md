# 추가 정보

## 핵심 내용
DOP(데이터 지향 프로그래밍)에서는 데이터 스키마와 데이터 표현을 분리하여 시스템 경계에서 들어오고 나가는 데이터의 유효성을 검증합니다. JSON Schema를 활용하면 클래스보다 더 유연하고 표현력이 높은 데이터 검증이 가능하며, 시스템 경계에서 데이터를 철저히 검증하면 시스템 내부에서의 추가 검증 필요성이 크게 줄어듭니다. 데이터 검증은 "받는 데이터에는 관대하게, 보내는 데이터에는 엄격하게" 하는 것이 좋은 관례입니다.

## 상세 핵심 내용
### DOP(Data-Oriented Programming)에서의 데이터 검증 개념

DOP에서 데이터 검증은 데이터 스키마를 데이터 표현으로부터 분리하는 4번째 원칙을 구현합니다. 이는 객체지향 프로그래밍과 달리 클래스 인스턴스화 시점이 아닌, 명시적 검증 시점에서 데이터의 유효성을 확인하는 접근법입니다.

### 시스템 경계에서의 데이터 검증

데이터 검증은 시스템 내부와 경계에서 발생하는 두 가지 형태로 구분됩니다. 시스템 경계는 데이터 교환이 발생하는 지점으로 정의되며, 웹 서버의 경우 다음 세 영역이 해당됩니다:

- **클라이언트 경계**: 웹 브라우저와 웹 서버 간 데이터 교환
- **데이터베이스 경계**: 웹 서버와 데이터베이스 간 데이터 교환  
- **웹 서비스 경계**: 웹 서버와 외부 웹 서비스 간 데이터 교환

시스템 경계에서의 검증은 잘못된 데이터가 시스템에 들어오거나 나가는 것을 방지하고, 무효한 데이터 발견 시 정보성 오류를 표시하는 목적을 가집니다. 경계에서의 데이터가 유효성을 확보하면 시스템 내부에서의 예상치 못한 데이터 발생 가능성이 현저히 낮아집니다.

### JSON Schema 기본 구조

JSON Schema는 데이터 검증을 위한 언어독립적 스키마 언어로, 다음과 같은 기본 구조를 가집니다:

```json
{
  "type": "object",
  "properties": {
    "title": {"type": "string"},
    "fields": {
      "type": "array",
      "items": {"type": "string"}
    }
  },
  "required": ["title", "fields"]
}
```

### 스키마의 유연성과 엄격성 제어

JSON Schema는 `additionalProperties` 필드를 통해 스키마에 명시되지 않은 필드의 허용 여부를 제어할 수 있습니다:

- **기본값 `true`**: 스키마에 명시되지 않은 필드 허용
- **`false` 설정**: 명시된 필드만 허용하여 엄격한 검증 수행

실무에서는 "보수적으로 전송하고, 관대하게 수용하라"는 견고성 원칙에 따라 요청에서는 추가 필드를 허용하고 응답에서는 엄격하게 제어하는 것이 권장됩니다.

### 스키마 조합(Schema Composition)

JSON Schema는 논리 연산자와 유사한 스키마 조합 기능을 제공합니다:

- **`allOf`**: AND 연산 (모든 스키마를 만족)
- **`anyOf`**: OR 연산 (하나 이상의 스키마를 만족)
- **`oneOf`**: XOR 연산 (정확히 하나의 스키마를 만족)

```javascript
var bookInfoSchema = {
  "allOf": [
    basicBookInfoSchema,
    {
      "anyOf": [mandatoryIsbn13, mandatoryIsbn10]
    }
  ]
};
```

### 데이터 검증 실패 세부 정보

데이터 검증은 단순한 참/거짓 판단이 아닌 실패 원인에 대한 상세 정보를 제공합니다. JavaScript의 Ajv 라이브러리의 경우:

```javascript
var ajv = new Ajv({allErrors: true}); // 모든 오류 수집
ajv.validate(schema, data);
ajv.errorsText(ajv.errors); // 인간 친화적 오류 메시지
```

기본적으로는 첫 번째 검증 실패만 감지하지만, `allErrors: true` 옵션을 통해 모든 검증 실패를 수집할 수 있습니다.

### 언어별 JSON Schema 검증 라이브러리

| 언어 | 라이브러리 | URL |
|------|------------|-----|
| JavaScript | Ajv | https://github.com/ajv-validator/ajv |
| Java | Snow | https://github.com/ssilverman/snowy-json |
| C# | JSON.net Schema | https://www.newtonsoft.com/jsonschema |
| Python | jschon | https://github.com/marksparkza/jschon |
| Ruby | JSONSchemer | https://github.com/davishmcclurg/json_schemer |

### 스키마의 재사용성과 조합성

JSON Schema는 일반적인 맵 구조로 표현되므로 다른 맵과 동일하게 조작할 수 있습니다. 이를 통해 스키마를 변수에 저장하고 다른 스키마에서 참조하여 재사용할 수 있으며, 클래스 정의보다 높은 조합성을 제공합니다.

### 고급 검증 기능

JSON Schema는 클래스 기반 데이터 표현으로는 표현하기 어려운 고급 검증 조건들을 지원합니다:

- 숫자 범위 검증
- 정규표현식을 통한 문자열 패턴 매칭
- 복잡한 조건부 검증 로직

### 외부 데이터 소스 검증

외부 데이터베이스나 웹 서비스로부터 받은 데이터는 시스템 경계에서 검증되어야 합니다. 이는 예상치 못한 데이터 구조나 타입으로 인한 시스템 오류를 방지하는 중요한 실무 관행입니다.

### 검증 전략

DOP에서의 데이터 검증은 다음 원칙을 따릅니다:

1. **경계 우선**: 시스템 경계에서의 검증이 가장 중요
2. **내부 선택적**: 경계에서 검증된 데이터는 내부에서 재검증이 필수적이지 않음
3. **관대한 수용**: 클라이언트 요청에 대해서는 유연한 검증
4. **엄격한 전송**: 서버 응답에 대해서는 엄격한 검증

이러한 접근법을 통해 DOP는 데이터의 무결성을 보장하면서도 시스템의 유연성과 확장성을 동시에 달성할 수 있습니다.

## 주요 화제
- DOP에서의 데이터 검증 원칙: 데이터 스키마와 데이터 표현의 분리, 시스템 경계에서의 데이터 검증이 내부 검증보다 중요함

- 시스템 경계 정의와 검증 전략: 클라이언트, 데이터베이스, 웹 서비스 경계에서 발생하는 데이터 교환 지점 식별 및 각 경계별 검증 방법

- JSON Schema 기본 문법과 구조: 타입 정의, 프로퍼티 설정, 배열 스키마, 열거형 값, 필수 필드 지정 등 JSON Schema 작성 방법

- 스키마 유연성과 엄격성 제어: additionalProperties 설정을 통한 추가 필드 허용/금지, 요청에는 유연하게 응답에는 엄격하게 적용하는 원칙

- 스키마 조합(Schema Composition): allOf, anyOf, oneOf를 사용한 복합 스키마 작성, 논리 연산자를 활용한 조건부 검증 구현

- 검증 실패 상세 정보 처리: Ajv 라이브러리를 통한 검증 오류 세부사항 추출, 다중 오류 감지 설정, 사용자 친화적 오류 메시지 생성

- 실무 적용 예시: 도서 검색 요청/응답, 외부 API 연동, 데이터베이스 응답 등 실제 웹 서비스에서의 데이터 검증 구현 사례

## 부차 화제
- JSON Schema 문법과 구조: JSON Schema의 type, properties, required, items, enum, additionalProperties 등 핵심 키워드들의 사용법과 스키마 작성 방법

- 스키마 조합(Schema Composition): allOf, anyOf, oneOf 키워드를 사용하여 여러 스키마를 논리적으로 결합하는 방법과 AND, OR 논리 연산 구현

- 데이터 유효성 검사 라이브러리: JavaScript Ajv, Java Snow, C# JSON.net Schema, Python jschon, Ruby JSONSchemer 등 언어별 JSON Schema 검증 라이브러리 소개

- 유효성 검사 오류 처리: 검증 실패 시 오류 정보 추출, 여러 오류 동시 수집(allErrors 옵션), 사람이 읽을 수 있는 형태로 오류 메시지 변환

- 스키마 유연성과 엄격성 설정: additionalProperties를 통한 추가 필드 허용/차단, required 배열을 통한 필수 필드 지정, 클라이언트 요청과 서버 응답에 대한 차별적 검증 정책

- Postel의 견고성 원칙: "보내는 것에는 보수적이고, 받는 것에는 관대하라"는 네트워크 통신 설계 철학과 데이터 검증 적용

- 스키마 재사용과 모듈화: 스키마를 변수로 저장하여 다른 스키마에서 재사용하는 방법과 복잡한 중첩 구조의 가독성 개선
