# 추가 정보

## 핵심 내용
JSON Schema 검증이 실패했을 때, 단순히 유효/무효 판정뿐만 아니라 실패 원인에 대한 상세 정보를 얻을 수 있습니다. Ajv 라이브러리에서는 `ajv.errors` 배열을 통해 누락된 필드명, 타입 불일치 등의 구체적인 오류 정보를 제공하며, `errorsText()` 함수로 사람이 읽기 쉬한 형태로 변환할 수 있습니다. 기본적으로는 첫 번째 오류만 감지하지만 `allErrors: true` 옵션을 사용하면 모든 검증 오류를 동시에 확인할 수 있어, 시스템 경계에서 클라이언트에게 정확한 오류 정보를 제공하여 데이터 수정을 안내할 수 있습니다.

## 상세 핵심 내용
### JSON Schema 검증 실패 시 상세 정보 처리

JSON Schema 검증은 DOP의 4번째 원칙인 데이터 스키마와 데이터 표현 분리를 실현하는 핵심 메커니즘입니다. 시스템 경계에서 데이터 검증이 실패했을 때, 단순한 성공/실패 판정이 아닌 구체적인 실패 원인에 대한 상세 정보를 제공하는 것이 중요합니다.

### 검증 실패 정보의 필요성

시스템 경계(클라이언트, 데이터베이스, 웹 서비스 경계)에서 데이터 검증이 실패할 때, 효과적인 디버깅과 사용자 경험을 위해서는 다음과 같은 구체적인 정보가 필요합니다:

- **필드 수준 오류**: 어떤 필수 필드가 누락되었는지
- **타입 불일치**: 어떤 필드가 예상된 타입과 다른지  
- **제약 조건 위반**: 구체적으로 어떤 검증 규칙을 위반했는지

이러한 상세 정보는 "받는 데이터에는 관대하게, 보내는 데이터에는 엄격하게"라는 견고성 원칙을 구현하는 데 필수적입니다.

### Ajv 라이브러리에서의 오류 처리 메커니즘

#### 기본 오류 정보 구조

```javascript
var searchBooksRequestSchema = {
    "type": "object",
    "properties": {
        "title": {"type": "string"},
        "fields": {
            "type": "array",
            "items": {"type": "string"}
        }
    },
    "required": ["title", "fields"],
    "additionalProperties": false  // 엄격한 검증
};

var invalidRequest = {
    "myTitle": "habit",  // 'title' 대신 'myTitle' 사용
    "fields": ["title", "weight"]
};

var ajv = new Ajv();
ajv.validate(searchBooksRequestSchema, invalidRequest);
// ajv.errors 배열에 상세 오류 정보 저장
```

검증 실패 시 반환되는 오류 객체의 구조:

```javascript
[
    {
        "instancePath": "",                    // 데이터 내 오류 발생 위치
        "schemaPath": "#/required",           // 스키마 내 해당 규칙 경로
        "keyword": "required",                // 위반된 검증 키워드
        "params": {
            "missingProperty": "title"        // 구체적인 오류 매개변수
        },
        "message": "must have required property 'title'"  // 오류 메시지
    }
]
```

### 사용자 친화적 오류 메시지 변환

복잡한 오류 객체를 읽기 쉬운 형태로 변환:

```javascript
ajv.errorsText(ajv.errors);
// → "data must have required property 'title'"
```

이는 시스템 경계에서 클라이언트에게 명확한 피드백을 제공하여 데이터 교환의 효율성을 높입니다.

### 다중 검증 오류 처리

#### allErrors 옵션의 중요성

기본적으로 Ajv는 첫 번째 검증 오류만 감지하지만, 시스템 경계에서는 모든 오류를 한 번에 확인하는 것이 효율적입니다:

```javascript
var invalidData = {
    "myTitle": "habit",     // 오류 1: 필수 필드 누락
    "fields": [1, 2]        // 오류 2,3: 배열 요소 타입 불일치
};

var ajv = new Ajv({allErrors: true}); // 모든 오류 수집
ajv.validate(searchBooksRequestSchema, invalidData);

ajv.errorsText(ajv.errors);
// → "data must have required property 'title',
// → data/fields/0 must be string,
// → data/fields/1 must be string"
```

이를 통해 클라이언트는 한 번의 요청으로 모든 수정 사항을 파악할 수 있습니다.

### JSON Schema 패턴 참조

#### 포괄적 스키마 구조 예제

```javascript
{
    "type": "array",                    // 루트: 배열 타입
    "items": {
        "type": "object",               // 각 요소: 객체
        "properties": {
            "myNumber": {"type": "number"},
            "myString": {"type": "string"},
            "myEnum": {"enum": ["value1", "value2"]},  // 제한된 값
            "myBool": {"type": "boolean"}
        },
        "required": ["myNumber", "myString"],    // 필수 필드
        "additionalProperties": false            // 추가 속성 금지
    }
}
```

#### 유효한 데이터 예제

```javascript
[
    {
        // 모든 필드 포함 (선택적 필드 포함)
        "myNumber": 42,
        "myString": "Hello",
        "myEnum": "value1",
        "myBool": true
    },
    {
        // 필수 필드만 포함 (유효)
        "myNumber": 54,
        "myString": "World"
    }
]
```

### 실무 적용과 시스템 경계에서의 활용

#### 웹 서비스 경계별 검증 전략

- **클라이언트 요청 검증**: 관대한 검증으로 `additionalProperties: true` 적용
- **데이터베이스 응답 검증**: 외부 시스템 데이터의 예상치 못한 변화 감지
- **웹 서비스 응답 검증**: 엄격한 검증으로 명시된 필드만 전송

#### 언어별 구현 고려사항

각 JSON Schema 검증 라이브러리마다 오류 처리 방식이 다르므로, 사용하는 언어와 라이브러리에 맞는 오류 정보 추출 방법을 확인해야 합니다:

| 언어 | 라이브러리 | 오류 처리 방식 |
|------|------------|----------------|
| JavaScript | Ajv | `errors` 배열, `errorsText()` |
| Java | Snow | 예외 객체 상세 정보 |
| Python | jschon | 검증 결과 객체 |

이러한 상세한 검증 오류 처리를 통해 시스템 경계에서의 데이터 무결성을 보장하면서도, 효율적인 디버깅과 사용자 경험을 제공할 수 있습니다. 이는 DOP에서 추구하는 데이터 중심적 접근법의 핵심 구현 요소입니다.

## 주요 화제
### 주요 화제 분석

- **JSON Schema 검증 실패 상세 정보 추출**: 데이터가 유효하지 않을 때 단순히 실패 여부만이 아니라 실패 원인에 대한 구체적인 정보(필수 필드 누락, 타입 불일치 등)를 얻을 수 있는 방법

- **Ajv 라이브러리의 오류 처리 메커니즘**: JavaScript Ajv 라이브러리에서 검증 실패 시 validator 인스턴스 내부의 errors 배열에 오류 정보가 저장되는 구조와 활용법

- **다중 검증 오류 처리**: 기본적으로 첫 번째 오류만 감지하는 Ajv를 allErrors 옵션을 통해 모든 검증 실패를 동시에 포착하는 방법

- **오류 정보의 사용자 친화적 변환**: errorsText 유틸리티 함수를 사용하여 복잡한 오류 배열을 사람이 읽기 쉬운 형태로 변환하는 기법

- **JSON Schema 설계 패턴과 실제 적용**: 객체 타입, 배열, 속성 정의, 필수 필드 지정, 열거형 값 등을 포함한 실용적인 스키마 작성 방법과 유효한 데이터 예시

## 부차 화제
- JSON Schema 검증 실패 상세 정보 접근: 데이터가 유효하지 않을 때 실패 이유에 대한 구체적인 세부사항을 얻는 방법
- Ajv 라이브러리의 오류 처리 메커니즘: JavaScript Ajv에서 검증 오류가 배열 형태로 validator 인스턴스에 저장되는 방식
- 단일 검증 실패 사례 분석: 필수 필드가 누락되었을 때 오류 정보의 구조와 내용
- 오류 정보의 가독성 향상: errorsText 유틸리티 함수를 사용하여 오류 배열을 인간이 읽기 쉬운 형태로 변환하는 방법
- 다중 검증 실패 처리: allErrors 옵션을 사용하여 여러 검증 오류를 한 번에 포착하는 방법
- JSON Schema 치트 시트: 다양한 데이터 타입과 검증 규칙을 포함한 JSON Schema 작성 가이드
- 유효한 데이터 예제: JSON Schema에 부합하는 올바른 데이터 구조의 실제 사례
