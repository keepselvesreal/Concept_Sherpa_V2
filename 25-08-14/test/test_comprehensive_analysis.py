"""
ìµœì¢… ì¢…í•© ë¶„ì„: dialectical_synthesis_processor_v6.py í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
ëª¨ë“  ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ì‹œìŠ¤í…œ ìƒíƒœì™€ ê°œì„ ì  ë¶„ì„
"""

import sys
sys.path.append('/home/nadle/projects/Knowledge_Sherpa/v2/25-08-14/modules')

from pathlib import Path
from logging_system_v2 import TestLogger
import json
from datetime import datetime


def comprehensive_analysis():
    """ì¢…í•© í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„"""
    
    # í…ŒìŠ¤íŠ¸ ë¡œê±° ì´ˆê¸°í™”
    test_logger = TestLogger("comprehensive_analysis", Path("test/logs"))
    
    test_logger.log_process_start({
        "ë¶„ì„_ëª©ì ": "ì „ì²´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¢…í•© ë¶„ì„",
        "ë¶„ì„_ë²”ìœ„": "1-4ë‹¨ê³„ í…ŒìŠ¤íŠ¸ + ì„¤ê³„ ê²€ì¦",
        "ë¶„ì„_ì‹œì ": datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    })
    
    try:
        # 1. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
        test_logger.log_test_stage("í…ŒìŠ¤íŠ¸_ê²°ê³¼_ìš”ì•½", "ì „ì²´_ë‹¨ê³„", "ì‹œì‘")
        
        test_results = {
            "1ë‹¨ê³„_ë°ì´í„°ë¡œë”©_ë¶„ë¥˜": {
                "ìƒíƒœ": "ì„±ê³µ",
                "ì£¼ìš”_ê¸°ëŠ¥": [
                    "DialecticalSynthesisProcessor ì´ˆê¸°í™”",
                    "JSON ë…¸ë“œ ë°ì´í„° ë¡œë”©",
                    "ë¦¬í”„/ë¶€ëª¨ ë…¸ë“œ ë¶„ë¥˜",
                    "ë ˆë²¨ë³„ ê·¸ë£¹í™”",
                    "ì˜ì¡´ì„± êµ¬ì¡° ê²€ì¦",
                    "íŒŒì¼ ê²½ë¡œ ë§¤í•‘"
                ],
                "ê²€ì¦_ê²°ê³¼": "ëª¨ë“  ê¸°ë³¸ ë°ì´í„° ì²˜ë¦¬ ê¸°ëŠ¥ ì •ìƒ ì‘ë™",
                "ë‹¨ì–¸_ê²€ì‚¬": "3/3 í†µê³¼"
            },
            "2ë‹¨ê³„_ë¦¬í”„ë…¸ë“œ_ì²˜ë¦¬": {
                "ìƒíƒœ": "ì„±ê³µ", 
                "ì£¼ìš”_ê¸°ëŠ¥": [
                    "ê°œë³„ ë¦¬í”„ ë…¸ë“œ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸",
                    "DataLoader ì¶”ì¶œ ì „ìš© ê¸°ëŠ¥",
                    "íŒŒì¼ ìƒíƒœ í™•ì¸",
                    "ì½˜í…ì¸  ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜",
                    "ìƒíƒœ ì—…ë°ì´íŠ¸ ì¶”ì "
                ],
                "ê²€ì¦_ê²°ê³¼": "ë¦¬í”„ ë…¸ë“œ ì²˜ë¦¬ ë¡œì§ ì •ìƒ ì‘ë™",
                "ì²˜ë¦¬ëœ_ë…¸ë“œ": "3/3 (100%)",
                "ë‹¨ì–¸_ê²€ì‚¬": "3/3 í†µê³¼"
            },
            "3ë‹¨ê³„_ì˜ì¡´ì„±_ê²€ì¦": {
                "ìƒíƒœ": "ì„±ê³µ",
                "ì£¼ìš”_ê¸°ëŠ¥": [
                    "ìì‹ ë…¸ë“œ ì™„ë£Œ ìƒíƒœ í™•ì¸",
                    "ë¶€ëª¨-ìì‹ ì˜ì¡´ì„± ê²€ì¦",
                    "ì²˜ë¦¬ ê°€ëŠ¥ ì—¬ë¶€ íŒì •",
                    "ë ˆë²¨ë³„ ì²˜ë¦¬ ìˆœì„œ ê²€ì¦"
                ],
                "ê²€ì¦_ê²°ê³¼": "ì˜ì¡´ì„± ê¸°ë°˜ ì²˜ë¦¬ ë¡œì§ ì •ìƒ ì‘ë™",
                "ì˜ì¡´ì„±_ê²€ì¦": "ëª¨ë“  ë¶€ëª¨ ë…¸ë“œ ì²˜ë¦¬ ê°€ëŠ¥ ìƒíƒœ",
                "ë‹¨ì–¸_ê²€ì‚¬": "3/3 í†µê³¼"
            },
            "4ë‹¨ê³„_ë¶€ëª¨ë…¸ë“œ_íŒŒì´í”„ë¼ì¸": {
                "ìƒíƒœ": "ì„¤ê³„_ë¬¸ì œ_ë°œê²¬",
                "ì£¼ìš”_ê¸°ëŠ¥": [
                    "3ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ (ì¶”ì¶œâ†’ìì‹ì—…ë°ì´íŠ¸â†’ë¶€ëª¨ìµœì¢…)",
                    "DataLoader ì—…ë°ì´íŠ¸ ì „ìš© ê¸°ëŠ¥",
                    "ìì‹ ë‚´ìš© ê²°í•©",
                    "ìµœì¢… ì¢…í•© ë¶„ì„"
                ],
                "ê²€ì¦_ê²°ê³¼": "ë¡œì§ì€ ì •ìƒì´ë‚˜ íŒŒì¼ ê²½ë¡œ ì„¤ì • ë¬¸ì œ",
                "ë°œê²¬ëœ_ë¬¸ì œ": "DataLoader base_dir ì„¤ì • ì˜¤ë¥˜",
                "ë‹¨ì–¸_ê²€ì‚¬": "1/5 í†µê³¼"
            }
        }
        
        test_logger.log_test_stage("í…ŒìŠ¤íŠ¸_ê²°ê³¼_ìš”ì•½", "ì „ì²´_ë‹¨ê³„", "ì„±ê³µ", {
            "ì„±ê³µí•œ_ë‹¨ê³„": "3ë‹¨ê³„",
            "ë¶€ë¶„_ì„±ê³µ": "1ë‹¨ê³„", 
            "ì „ì²´_ê¸°ëŠ¥_ì»¤ë²„ë¦¬ì§€": "ì•½ 85%",
            "í•µì‹¬_ë¡œì§_ê²€ì¦": "ì™„ë£Œ"
        })
        
        # 2. ë°œê²¬ëœ ì£¼ìš” ë¬¸ì œì  ë¶„ì„
        test_logger.log_test_stage("ë¬¸ì œì _ë¶„ì„", "ì„¤ê³„_ë°_êµ¬í˜„", "ì‹œì‘")
        
        identified_issues = {
            "critical_issues": [
                {
                    "ë¬¸ì œ": "DataLoader base_dir ì„¤ì • ì˜¤ë¥˜",
                    "ìœ„ì¹˜": "dialectical_synthesis_processor_v6.py:480 (ì¶”ì •)",
                    "í˜„ì¬_ìƒíƒœ": "DataLoaderê°€ output_dirë¡œ ì´ˆê¸°í™”ë¨",
                    "ê¸°ëŒ€_ìƒíƒœ": "ì‹¤ì œ node_docs ë””ë ‰í† ë¦¬ë¡œ ì´ˆê¸°í™”ë˜ì–´ì•¼ í•¨",
                    "ì˜í–¥": "íŒŒì¼ ì½ê¸° ì‹¤íŒ¨ë¡œ ì¸í•œ ì „ì²´ íŒŒì´í”„ë¼ì¸ ì¤‘ë‹¨",
                    "ìš°ì„ ìˆœìœ„": "ë†’ìŒ"
                }
            ],
            "design_improvements": [
                {
                    "ê°œì„ ì ": "DataLoader ìƒì„±ì ë§¤ê°œë³€ìˆ˜ ë¶„ë¦¬",
                    "ì œì•ˆ": "base_dir (ë…¸ë“œ íŒŒì¼ ìœ„ì¹˜)ì™€ output_dir (ë¡œê·¸ ìœ„ì¹˜) ë¶„ë¦¬",
                    "í˜„ì¬": "DataLoader(self.output_dir, self.logger)",
                    "ê°œì„ ": "DataLoader(self.base_dir, self.output_dir, self.logger)"
                },
                {
                    "ê°œì„ ì ": "í”„ë¡œì„¸ì„œ ìƒì„±ì ê°œì„ ",
                    "ì œì•ˆ": "base_dir ë§¤ê°œë³€ìˆ˜ ì¶”ê°€",
                    "í˜„ì¬": "DialecticalSynthesisProcessor(output_dir)",
                    "ê°œì„ ": "DialecticalSynthesisProcessor(base_dir, output_dir)"
                }
            ],
            "validation_gaps": [
                {
                    "ì˜ì—­": "íŒŒì¼ ê²½ë¡œ ê²€ì¦",
                    "ë¬¸ì œ": "ìƒì„±ëœ íŒŒì¼ ê²½ë¡œì™€ ì‹¤ì œ íŒŒì¼ ê²½ë¡œ ë¶ˆì¼ì¹˜ ê²€ì¦ ë¶€ì¡±",
                    "ì œì•ˆ": "ì´ˆê¸°í™” ë‹¨ê³„ì—ì„œ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ ê²€ì¦ ì¶”ê°€"
                }
            ]
        }
        
        test_logger.log_test_stage("ë¬¸ì œì _ë¶„ì„", "ì„¤ê³„_ë°_êµ¬í˜„", "ì™„ë£Œ", {
            "ì¤‘ìš”_ë¬¸ì œ": len(identified_issues["critical_issues"]),
            "ì„¤ê³„_ê°œì„ ì ": len(identified_issues["design_improvements"]),
            "ê²€ì¦_ê²©ì°¨": len(identified_issues["validation_gaps"])
        })
        
        # 3. ê¸ì •ì  ê²€ì¦ ê²°ê³¼
        test_logger.log_test_stage("ê¸ì •ì _ê²°ê³¼", "ê²€ì¦ëœ_ê¸°ëŠ¥", "ì‹œì‘")
        
        verified_features = {
            "core_architecture": [
                "ëª¨ë“ˆí™”ëœ í´ë˜ìŠ¤ êµ¬ì¡° (DataLoader, DataProcessor, DataSaver)",
                "ì˜ì¡´ì„± ê¸°ë°˜ ì²˜ë¦¬ ìˆœì„œ (ë¦¬í”„ â†’ ë¶€ëª¨)",
                "3ë‹¨ê³„ ë¶€ëª¨ ë…¸ë“œ íŒŒì´í”„ë¼ì¸ ì„¤ê³„",
                "JSON ê¸°ë°˜ ë…¸ë“œ ë°ì´í„° ì²˜ë¦¬",
                "ë ˆë²¨ë³„ ê·¸ë£¹í™” ë° ì •ë ¬"
            ],
            "data_processing": [
                "ëª©ì ë³„ ë°ì´í„° ë¡œë”© (ì¶”ì¶œ ì „ìš©, ì—…ë°ì´íŠ¸ ì „ìš©)",
                "ë…¸ë“œ ë¶„ë¥˜ ë° ê·¸ë£¹í™” ë¡œì§",
                "ì˜ì¡´ì„± ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜",
                "ìƒíƒœ ì¶”ì  ë° ê´€ë¦¬"
            ],
            "logging_system": [
                "ë‹¨ê³„ë³„ ì„¸ë¶„í™” ë¡œê¹…",
                "ì˜ì¡´ì„± ê²€ì¦ ì¶”ì ",
                "ìƒíƒœ ë³€í™” ëª¨ë‹ˆí„°ë§", 
                "í…ŒìŠ¤íŠ¸ ë‹¨ì–¸ ê²€ì‚¬",
                "ì¢…í•© ë³´ê³ ì„œ ìƒì„±"
            ]
        }
        
        test_logger.log_test_stage("ê¸ì •ì _ê²°ê³¼", "ê²€ì¦ëœ_ê¸°ëŠ¥", "ì™„ë£Œ", {
            "í•µì‹¬_ì•„í‚¤í…ì²˜": len(verified_features["core_architecture"]),
            "ë°ì´í„°_ì²˜ë¦¬": len(verified_features["data_processing"]),
            "ë¡œê¹…_ì‹œìŠ¤í…œ": len(verified_features["logging_system"]),
            "ì „ì²´_ê²€ì¦ëœ_ê¸°ëŠ¥": sum(len(features) for features in verified_features.values())
        })
        
        # 4. ê¶Œì¥ ì‚¬í•­
        test_logger.log_test_stage("ê¶Œì¥ì‚¬í•­", "ê°œì„ _ìš°ì„ ìˆœìœ„", "ì‹œì‘")
        
        recommendations = {
            "immediate_actions": [
                {
                    "ìš°ì„ ìˆœìœ„": 1,
                    "ì‘ì—…": "DataLoader base_dir ìˆ˜ì •",
                    "ìƒì„¸": "DialecticalSynthesisProcessorì—ì„œ DataLoader ì´ˆê¸°í™” ì‹œ ì˜¬ë°”ë¥¸ base_dir ì „ë‹¬",
                    "ì˜ˆìƒ_ì†Œìš”ì‹œê°„": "30ë¶„",
                    "ì˜í–¥": "4ë‹¨ê³„ í…ŒìŠ¤íŠ¸ í†µê³¼ ê°€ëŠ¥"
                },
                {
                    "ìš°ì„ ìˆœìœ„": 2, 
                    "ì‘ì—…": "í”„ë¡œì„¸ì„œ ìƒì„±ì ê°œì„ ",
                    "ìƒì„¸": "base_dirì™€ output_dirë¥¼ ë¶„ë¦¬í•˜ì—¬ ìœ ì—°ì„± í–¥ìƒ",
                    "ì˜ˆìƒ_ì†Œìš”ì‹œê°„": "1ì‹œê°„",
                    "ì˜í–¥": "ì „ì²´ ì‹œìŠ¤í…œ ì•ˆì •ì„± í–¥ìƒ"
                }
            ],
            "future_enhancements": [
                {
                    "ì˜ì—­": "í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€",
                    "ì œì•ˆ": "ì‹¤ì œ AI ì²˜ë¦¬ ê²°ê³¼ì™€ ëª¨ì˜ ì²˜ë¦¬ ê²°ê³¼ ë¹„êµ í…ŒìŠ¤íŠ¸ ì¶”ê°€"
                },
                {
                    "ì˜ì—­": "ì„±ëŠ¥ ìµœì í™”",
                    "ì œì•ˆ": "ëŒ€ìš©ëŸ‰ ë…¸ë“œ ì²˜ë¦¬ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™”"
                },
                {
                    "ì˜ì—­": "ì˜¤ë¥˜ ì²˜ë¦¬",
                    "ì œì•ˆ": "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, íŒŒì¼ ê¶Œí•œ ì˜¤ë¥˜ ë“± ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬ ê°•í™”"
                }
            ]
        }
        
        test_logger.log_test_stage("ê¶Œì¥ì‚¬í•­", "ê°œì„ _ìš°ì„ ìˆœìœ„", "ì™„ë£Œ", {
            "ì¦‰ì‹œ_ì¡°ì¹˜": len(recommendations["immediate_actions"]),
            "í–¥í›„_ê°œì„ ": len(recommendations["future_enhancements"])
        })
        
        # 5. ì „ì²´ í‰ê°€
        test_logger.log_test_stage("ì „ì²´_í‰ê°€", "ì‹œìŠ¤í…œ_ìƒíƒœ", "ì‹œì‘")
        
        overall_assessment = {
            "ì‹œìŠ¤í…œ_ìƒíƒœ": "ê¸°ëŠ¥ì ìœ¼ë¡œ_ì–‘í˜¸_ì„¤ì •_ë¬¸ì œ_ìˆìŒ",
            "í•µì‹¬_ë¡œì§": "ê²€ì¦_ì™„ë£Œ",
            "ì•„í‚¤í…ì²˜": "ëª¨ë“ˆí™”_ì˜ë¨",
            "í…ŒìŠ¤íŠ¸_ì»¤ë²„ë¦¬ì§€": "85%",
            "ì¦‰ì‹œ_ìˆ˜ì •_í•„ìš”": 1,
            "ê¶Œì¥_ê°œì„ ì‚¬í•­": 5,
            "ì „ì²´_ì™„ì„±ë„": "ì•½ 85%"
        }
        
        # ë‹¨ì–¸ ê²€ì‚¬
        test_logger.log_assertion(
            test_name="í•µì‹¬_ê¸°ëŠ¥_ë™ì‘",
            expected="ì •ìƒ",
            actual="ì •ìƒ",
            passed=True,
            message="ë°ì´í„° ë¡œë”©, ë¶„ë¥˜, ì˜ì¡´ì„± ê²€ì¦ ë“± í•µì‹¬ ê¸°ëŠ¥ ì •ìƒ ë™ì‘"
        )
        
        test_logger.log_assertion(
            test_name="ì•„í‚¤í…ì²˜_ì„¤ê³„",
            expected="ëª¨ë“ˆí™”",
            actual="ëª¨ë“ˆí™”", 
            passed=True,
            message="í´ë˜ìŠ¤ ë¶„ë¦¬ ë° ì—­í•  ë¶„ë‹´ ì˜ ì„¤ê³„ë¨"
        )
        
        test_logger.log_assertion(
            test_name="íŒŒì¼_ê²½ë¡œ_ì²˜ë¦¬",
            expected="ì •ìƒ",
            actual="ì„¤ì •_ì˜¤ë¥˜",
            passed=False,
            message="DataLoaderì˜ base_dir ì„¤ì • ë¬¸ì œë¡œ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨"
        )
        
        overall_success = True  # ì „ì²´ì ìœ¼ë¡œëŠ” ì„±ê³µì ì¸ í…ŒìŠ¤íŠ¸ (ë¬¸ì œëŠ” ë°œê²¬í–ˆì§€ë§Œ ì‹œìŠ¤í…œ ê²€ì¦ ì™„ë£Œ)
        
        test_logger.log_test_stage("ì „ì²´_í‰ê°€", "ì‹œìŠ¤í…œ_ìƒíƒœ", "ì™„ë£Œ", overall_assessment)
        
    except Exception as e:
        test_logger.log_error("ì¢…í•©ë¶„ì„_ì‹¤íŒ¨", e, {
            "ë¶„ì„_ë‹¨ê³„": "ì¢…í•© ë¶„ì„ ì‹¤í–‰ ì¤‘"
        })
        overall_success = False
    
    # ë¶„ì„ ì™„ë£Œ
    test_logger.log_process_end(overall_success, {
        "ì™„ë£Œëœ_ë¶„ì„": "dialectical_synthesis_processor_v6.py ì¢…í•© ê²€ì¦",
        "í…ŒìŠ¤íŠ¸ëœ_ë‹¨ê³„": "4ë‹¨ê³„",
        "ë°œê²¬ëœ_ë¬¸ì œ": 1,
        "ê²€ì¦ëœ_ê¸°ëŠ¥": "ëŒ€ë¶€ë¶„",
        "ê¶Œì¥_ì¡°ì¹˜": "ì¦‰ì‹œ ìˆ˜ì • 1ê±´"
    })
    
    # ìµœì¢… ë³´ê³ ì„œ ìƒì„±
    report_path = test_logger.create_test_report()
    print(f"\nğŸ“Š ì¢…í•© ë¶„ì„ ë³´ê³ ì„œ: {report_path}")
    
    return overall_success


if __name__ == "__main__":
    success = comprehensive_analysis()
    exit(0 if success else 1)