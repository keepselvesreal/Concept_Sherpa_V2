# 6.2.3 Unit tests for nodes in the tree

**페이지**: 150-152
**계층**: Data-Oriented Programming (node0) > Part1—Flexibility (node1) > 6 Unit tests (node2) > Chapter 6
**추출 시간**: 2025-08-06 19:46:57

---


--- 페이지 150 ---

122 CHAPTER 6 Unit tests
Theo In cases where the query string matches, the expected result is a JSON string
with the book info. In cases where the query string doesn’t match, the
expected result is a JSON string with an empty array.
Joe Hmm...
Theo What?
Joe I don’t like your answer.
Theo Why?
Joe Because your test case relies on a string comparison instead of a data comparison.
Theo What difference does it make? After all, the strings I’m comparing come from
the serialization of data.
Joe It’s inherently much more complex to compare JSON strings than it is to com-
pare data. For example, two different strings might be the serialization of the
same piece of data.
Theo Really? How?
Joe Take a look at these two strings. They are the serialization of the same data.
They’re different strings because the fields appear in a different order, but in
fact, they serialize the same data!
Joe turns his laptop to Theo. As Theo looks at the code, he realizes that, once again, Joe
iscorrect.
Listing6.13 Two different strings that serialize the same data
var stringA = "{\"title\":\"Watchmen\",\"publicationYear\":1987}";
var stringB = "{\"publicationYear\":1987,\"title\":\"Watchmen\"}";
TIP Avoid using a string comparison in unit tests for functions that deal with data.
Theo I see.... Well, what can I do instead?
Joe Instead of comparing the output of Library.searchBooksByTitleJSON with
a string, you could deserialize the output and compare it to the expected data.
Theo What do you mean by deserialize a string?
Joe Deserializing a string s, for example, means to generate a piece of data whose
serialization is s.
Theo Is there a Lodash function for string deserialization?
Joe Actually, there is a native JavaScript function for string deserialization; it’s
called JSON.parse.
Joe retrieves his laptop and shows Theo an example of string deserialization. The code
illustrates a common usage of JSON.parse.
Listing6.14 Example of string deserialization
var myString = "{\"publicationYear\":1987,\"title\":\"Watchmen\"}";
var myData = JSON.parse(myString);

--- 페이지 150 끝 ---


--- 페이지 151 ---

6.3 Unit tests for queries 123
_.get(myData, "title");
// → "Watchmen"
Theo Cool! Let me try writing a unit test for Library.searchBooksByTitleJSON
using JSON.parse.
It doesn’t take Theo too much time to come up with a piece of code. Using his laptop, he
inputs the unit test.
Listing6.15 Unit test for Library.searchBooksByTitleJSON
var libraryData = {
"catalog": {
"booksByIsbn": {
"978-1779501127": {
"isbn": "978-1779501127",
"title": "Watchmen",
"publicationYear": 1987,
"authorIds": ["alan-moore",
"dave-gibbons"]
}
},
"authorsById": {
"alan-moore": {
"name": "Alan Moore",
"bookIsbns": ["978-1779501127"]
},
"dave-gibbons": {
"name": "Dave Gibbons",
"bookIsbns": ["978-1779501127"]
}
}
}
};
var bookInfo = {
"isbn": "978-1779501127",
"title": "Watchmen",
"authorNames": ["Alan Moore",
"Dave Gibbons"]
};
_.isEqual(JSON.parse(Library.searchBooksByTitleJSON(libraryData,
"Watchmen")),
[bookInfo]);
_.isEqual(JSON.parse(Library.searchBooksByTitleJSON(libraryData,
"Batman")),
[]);
Joe Well done! I think you’re ready to move on to the last piece of the puzzle and
write the unit test for Catalog.searchBooksByTitle.

--- 페이지 151 끝 ---


--- 페이지 152 ---

124 CHAPTER 6 Unit tests
Because Theo and Joe have been discussing unit tests for quite some time, he asks Joe if he
would like another espresso. They call the waiter and order, then Theo looks again at the
code for Catalog.searchBooksByTitle.
Listing6.16 The code of Catalog.searchBooksByTitle
Catalog.searchBooksByTitle = function(catalogData, query) {
var allBooks = _.get(catalogData, "booksByIsbn");
var matchingBooks = _.filter(allBooks, function(book) {
return _.get(book, "title").includes(query);
});
var bookInfos = _.map(matchingBooks, function(book) {
return Catalog.bookInfo(catalogData, book);
});
return bookInfos;
};
Writing the unit test for Catalog.searchBooksByTitle is a more pleasant experience for
Theo than writing the unit test for Library.searchBooksByTitleJSON. He appreciates
this for two reasons:
 It’s not necessary to deserialize the output because the function returns data.
 It’s not necessary to wrap the catalog data in a library data map.
Listing6.17 Unit test for Catalog.searchBooksByTitle
var catalogData = {
"booksByIsbn": {
"978-1779501127": {
"isbn": "978-1779501127",
"title": "Watchmen",
"publicationYear": 1987,
"authorIds": ["alan-moore",
"dave-gibbons"]
}
},
"authorsById": {
"alan-moore": {
"name": "Alan Moore",
"bookIsbns": ["978-1779501127"]
},
"dave-gibbons": {
"name": "Dave Gibbons",
"bookIsbns": ["978-1779501127"]
}
}
};
var bookInfo = {
"isbn": "978-1779501127",
"title": "Watchmen",
"authorNames": ["Alan Moore",
"Dave Gibbons"]
};

--- 페이지 152 끝 ---
