# 6.4 Unit tests for mutations

**페이지**: 155-157
**계층**: Data-Oriented Programming (node0) > Part1—Flexibility (node1) > 6 Unit tests (node2) > Chapter 6
**추출 시간**: 2025-08-06 19:46:58

---


--- 페이지 155 ---

6.4 Unit tests for mutations 127
Joe Excellent! So which functions of the tree should be unit tested for the add
member mutation?
Theo I think the functions we need to test are System.addMember, SystemState
.get, SystemState.commit, Library.addMember, and UserManagement
.addMember. That right?
Joe You’re totally right. Let’s defer writing unit tests for functions that belong to
SystemState until later. Those are generic functions that should be tested
outside the context of a specific mutation. Let’s assume for now that we’ve
already written unit tests for the SystemState class. We’re left with three func-
tions: System.addMember, Library.addMember, and UserManagement.add-
Member.
Theo In what order should we write the unit tests, bottom up or top down?
Joe Let’s start where the real meat is—in UserManagement.addMember. The two
other functions are just wrappers.
Theo OK.
Joe Writing a unit test for the main function of a mutation requires more effort
than writing the test for a query. The reason is that a query returns a response
based on the system data, whereas a mutation computes a new state of the system
based on the current state of the system and some arguments (see figure 6.6).
SystemData Argument Argument SystemData
Mutation Query
NextSystemData ResponseData
Figure 6.6 The output of a mutation is more complex than
the output of a query.
TIP Writing a unit test for the main function of a mutation requires more effort than
for a query.
Theo It means that in the test cases of UserManagement.addMember, both the input
and the expected output are maps that describe the state of the system.
Joe Exactly. Let’s start with the simplest case, where the initial state of the system
is empty.
Theo You mean that userManagementData passed to UserManagement.addMember
is an empty map?
Joe Yes.
Once again, Theo places his hands over his laptop keyboard, thinks for a moment, and
begins typing. He reminds himself that the code needs to add a member to an empty user

--- 페이지 155 끝 ---


--- 페이지 156 ---

128 CHAPTER 6 Unit tests
management map and to check that the resulting map is as expected. When he’s finished,
he shows his code to Joe.
Listing6.22 Test case for Catalog.addMember without members
var member = {
"email": "jessie@gmail.com",
"password": "my-secret"
};
var userManagementStateBefore = {};
var expectedUserManagementStateAfter = {
"membersByEmail": {
"jessie@gmail.com": {
"email": "jessie@gmail.com",
"password": "my-secret"
}
}
};
var result = UserManagement.addMember(userManagementStateBefore, member);
_.isEqual(result, expectedUserManagementStateAfter);
Joe Very nice! Keep going and write a test case when the initial state is not empty.
Theo knows this requires a few more lines of code but nothing complicated. When he fin-
ishes, he once again shows the code to Joe.
Listing6.23 Test case for Catalog.addMember with existing members
var jessie = {
"email": "jessie@gmail.com",
"password": "my-secret"
};
var franck = {
"email": "franck@gmail.com",
"password": "my-top-secret"
};
var userManagementStateBefore = {
"membersByEmail": {
"franck@gmail.com": {
"email": "franck@gmail.com",
"password": "my-top-secret"
}
}
};
var expectedUserManagementStateAfter = {
"membersByEmail": {
"jessie@gmail.com": {
"email": "jessie@gmail.com",

--- 페이지 156 끝 ---


--- 페이지 157 ---

6.4 Unit tests for mutations 129
"password": "my-secret"
},
"franck@gmail.com": {
"email": "franck@gmail.com",
"password": "my-top-secret"
}
}
};
var result = UserManagement.addMember(userManagementStateBefore, jessie);
_.isEqual(result, expectedUserManagementStateAfter);
Joe Awesome! Can you think of other test cases for UserManagement.addMember?
Theo No.
Joe What about cases where the mutation fails?
Theo Right! I always forget to think about negative test cases. I assume that relates to
the fact that I’m an optimistic person.
TIP Don’t forget to include negative test cases in your unit tests.
Joe Me too. The more I meditate, the more I’m able to focus on the positive side of
life. Anyway, how would you write a test case where the mutation fails?
Theo I would pass to UserManagement.addMember a member that already exists in
userManagementStateBefore.
Joe And how would you check that the code behaves as expected in case of a failure?
Theo Let me see. When a member already exists, UserManagement.addMember
throws an exception. Therefore, what I need to do in my test case is to wrap the
code in a try/catch block.
Joe Sounds good to me.
Once again, it doesn’t require too much of an effort for Theo to create a new test case.
When he’s finished, he eagerly turns his laptop to Joe.
Listing6.24 Test case for UserManagement.addMember if it’s expected to fail
var jessie = {
"email": "jessie@gmail.com",
"password": "my-secret"
};
var userManagementStateBefore = {
"membersByEmail": {
"jessie@gmail.com": {
"email": "jessie@gmail.com",
"password": "my-secret"
}
}
};

--- 페이지 157 끝 ---
