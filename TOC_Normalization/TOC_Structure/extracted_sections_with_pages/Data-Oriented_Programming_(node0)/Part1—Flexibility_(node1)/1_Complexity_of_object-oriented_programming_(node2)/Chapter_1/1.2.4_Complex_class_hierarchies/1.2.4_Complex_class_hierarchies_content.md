# 1.2.4 Complex class hierarchies

**페이지**: 48-51
**계층**: Data-Oriented Programming (node0) > Part1—Flexibility (node1) > 1 Complexity of object-oriented programming (node2) > Chapter 1
**추출 시간**: 2025-08-06 19:46:43

---


--- 페이지 48 ---

20 CHAPTER 1 Complexity of object-orientedprogramming
The bad news is that Theo would have to repeat the same process for every end-
point of the system. Each time he encounters a new kind of JSON input or output,
he would have to create a new class and write code. Theo’s dream is turning into a
nightmare!
Suddenly, his phone rings, next to where he was resting his head on the desk. As Theo
wakes up, he realizes that Nancy never asked for JSON. It was all a dream...a really bad
dream!
TIP In OOP, data serialization is difficult.
It’s quite frustrating that handling JSON serialization and deserialization in OOP
requires the addition of so many classes and writing so much code—again and again!
The frustration grows when you consider that serializing a search query, a book item
query, or any query is quite similar. It comes down to
 Going over data fields.
 Concatenating the name of the data fields and the value of the data fields, sepa-
rated by a comma.
Why is such a simple thing so hard to achieve in OOP? In OOP, data has to follow a
rigid shape defined in classes, which means that data is locked in members. There is
no simple way to access data generically.
TIP In OOP, data is locked in classes as members.
We will refine later what we mean by generic access to the data, and we will see how
DOP provides a generic way to handle JSON serialization and deserialization. Until
then, you will have to continue suffering. But at least you are starting to become aware
of this suffering, and you know that it is avoidable.
 NOTE Most OOP programming languages alleviate a bit of the difficulty involved
in the conversion from and to JSON. It either involves reflection, which is definitely a
complex thing, or code verbosity.
1.2.4 Complex class hierarchies
One way to avoid writing the same code twice in OOP involves class inheritance. Indeed,
when every requirement of the system is known up front, you design your class hier-
archy is such a way that classes with common behavior derive from a base class.
Figure 1.15 shows an example of this pattern that focuses on the part of our class
diagram that deals with members and librarians. Both Librarians and Members need
the ability to log in, and they inherit this ability from the User class.
So far, so good, but when new requirements are introduced after the system is imple-
mented, it’s a completely different story. Fast forward to Monday, March 29th, at 11:00 AM,
where two days are left before the deadline (Wednesday at midnight).

--- 페이지 48 끝 ---


--- 페이지 49 ---

1.2 Sources of complexity 21
C Librarian
blockMember(member: Member) : Bool
unblockMember(member: Member) : Bool
addBookItem(bookItem: BookItem) : BookItem
getBookLendingsOfMember(member: Member) : List<BookLending>
CC Member
isBlocked() : Bool
returnBook(bookLending : BookLending) : Bool
checkout(bookItem: BookItem) : BookLending
C User
id : String
email : String Figure 1.15 The part of the
password : String class diagram that deals with
login() : Bool members and librarians
Nancy calls Theo with an urgent request. Theo is not sure if it’s a dream or reality. He
pinches himself and he can feel the jolt. It’s definitely reality!
Nancy How is the project doing?
Theo Fine, Nancy. We’re on schedule to meet the deadline. We’re running our last
round of regression tests now.
Nancy Fantastic! It means we have time for adding a tiny feature to the system, right?
Theo Depends what you mean by “tiny.”
Nancy We need to add VIP members to the system.
Theo What do you mean by VIP members?
Nancy VIP members are allowed to add book items to the library by themselves.
Theo Hmm...
Nancy What?
Theo That’s not a tiny change!
Nancy Why?
I’ll ask you the same question Nancy asked Theo: why is adding VIP members to our
system not a tiny task? After all, Theo has already written the code that allows librari-
ans to add book items to the library (it’s in Librarian::addBookItem). What prevents
him from reusing this code for VIP members? The reason is that, in OOP, the code is
locked into classes as methods.
TIP In OOP, code is locked into classes.
VIP members are members that are allowed to add book items to the library by them-
selves. Theo decomposes the customer requirements into two pieces:

--- 페이지 49 끝 ---


--- 페이지 50 ---

22 CHAPTER 1 Complexity of object-orientedprogramming
 VIP members are library members.
 VIP members are allowed to add book items to the library by themselves.
Theo then decides that he needs a new class, VIPMember. For the first requirement
(VIP members are library members), it seems reasonable to make VIPMember derive
from Member. However, handling the second requirement (VIP members are allowed
to add book items) is more complex. He cannot make a VIPMember derive from
Librarian because the relation between VIPMember and Librarian is not linear:
 On one hand, VIP members are like librarians in that they are allowed to add
book items.
 On the other hand, VIP members are not like librarians in that they are not
allowed to block members or list the books lent to a member.
The problem is that the code that adds book items is locked in the Librarian class.
There is no way for the VIPMember class to use this code.
Figure 1.16 shows one possible solution that makes the code of Librarian::add-
BookItem available to both Librarian and VIPMember classes. Here are the changes to
the previous class diagram:
 A base class UserWithBookItemRight extends User.
 addBookItem moves from Librarian to UserWithBookItemRight.
 Both VIPMember and Librarian extend UserWithBookItemRight.
C Librarian
blockMember(member: Member) : Bool C VIPMember
unblockMember(member: Member) : Bool
getBookLendingsOfMember(member: Member) : List<BookLending>
CC Member
CC UserWithBookItemRight
isBlocked() : Bool
returnBook(bookLending : BookLending) : Bool addBookItem(bookItem: BookItem) : BookItem
checkout(bookItem: BookItem) : BookLending
C User
id : String
email : String
password : String
login() : Bool
Figure 1.16 A class diagram for a system with VIP members
It wasn’t easy, but Theo manages to handle the change on time, thanks to an all nighter
coding on his laptop. He was even able to add new tests to the system and run the regres-
sion tests again. However, he was so excited that he didn’t pay attention to the diamond

--- 페이지 50 끝 ---


--- 페이지 51 ---

1.2 Sources of complexity 23
problem VIPMember introduced in his class diagram due to multiple inheritance: VIPMember
extends both Member and UserWithBookItemRight, which both extend User.
Wednesday, March 31, at 10:00 AM (14 hours before the deadline), Theo calls Nancy to
tell her the good news.
Theo We were able to add VIP members to the system on time, Nancy.
Nancy Fantastic! I told you it was a tiny feature.
Theo Yeah, well...
Nancy Look, I was going to call you anyway. I just finished a meeting with my business
partner, and we realized that we need another tiny feature before the launch.
Will you be able to handle it before the deadline?
Theo Again, it depends what you mean by “tiny.”
Nancy We need to add Super members to the system.
Theo What do you mean by Super members?
Nancy Super members are allowed to list the books lent to other members.
Theo Err...
Nancy What?
Theo That’s not a tiny change!
Nancy Why?
As with VIP members, adding Super members to the system requires changes to Theo’s
class hierarchy. Figure 1.17 shows the solution Theo has in mind.
C Librarian
C VIPMember C SuperMember
getBookLendingsOfMember(member: Member) : List<BookLending>
CC UserWithBlockMemberRight
CC UserWithBookItemRight
blockMember(member: Member) : Bool
addBookItem(bookItem: BookItem) : BookItem
unblockMember(member: Member) : Bool
CC Member
isBlocked() : Bool
returnBook(bookLending : BookLending) : Bool
checkout(bookItem: BookItem) : BookLending
C User
id : String
email : String
password : String
login() : Bool
Figure 1.17 A class diagram for a system with Super and VIP members
The addition of Super members has made the system really complex. Theo suddenly
notices that he has three diamonds in his class diagram—not gemstones but three “Deadly

--- 페이지 51 끝 ---
