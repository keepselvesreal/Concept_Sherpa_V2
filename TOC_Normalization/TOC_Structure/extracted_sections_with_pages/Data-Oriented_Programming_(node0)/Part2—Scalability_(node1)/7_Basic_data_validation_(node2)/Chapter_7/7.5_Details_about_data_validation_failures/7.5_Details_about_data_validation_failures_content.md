# 7.5 Details about data validation failures

**페이지**: 184-186
**계층**: Data-Oriented Programming (node0) > Part2—Scalability (node1) > 7 Basic data validation (node2) > Chapter 7
**추출 시간**: 2025-08-06 19:47:02

---


--- 페이지 184 ---

156 CHAPTER 7 Basic data validation
isbn_13 is required; and mandatoryIsb10, a schema where only isbn_10 is
required?
Theo I think it should be basicBookInfoSchema AND (mandatoryIsbn13 OR
mandatoryIsbn10).
Joe Exactly! The only thing is that in JSON Schema, we use allOf instead of AND,
and anyOf instead of OR.
Joe shows Theo the result in listing 7.18 and an example of its usage in listing 7.19.
Listing7.18 Schema of an external API response
var basicBookInfoSchema = {
"type": "object",
"required": ["title"],
"properties": {
"title": {"type": "string"},
"publishers": {
"type": "array",
"items": {"type": "string"}
},
"number_of_pages": {"type": "integer"},
"weight": {"type": "string"},
"physical_format": {"type": "string"},
"subjects": {
"type": "array",
"items": {"type": "string"}
},
"isbn_13": {
"type": "array",
"items": {"type": "string"}
},
"isbn_10": {
"type": "array",
"items": {"type": "string"}
},
"publish_date": {"type": "string"},
"physical_dimensions": {"type": "string"}
}
};
var mandatoryIsbn13 = {
"type": "object",
"required": ["isbn_13"]
};
var mandatoryIsbn10 = {
"type": "object",
"required": ["isbn_10"]
};
var bookInfoSchema = {
"allOf": [
basicBookInfoSchema,
{

--- 페이지 184 끝 ---


--- 페이지 185 ---

7.4 Schema composition 157
"anyOf": [mandatoryIsbn13, mandatoryIsbn10]
}
]
};
Listing7.19 Validating an external API response
var bookInfo = {
"publishers": [
"DC Comics"
],
"number_of_pages": 334,
"weight": "1.4 pounds",
"physical_format": "Paperback",
"subjects": [
"Graphic Novels",
"Comics & Graphic Novels",
"Fiction",
"Fantastic fiction"
],
"isbn_13": [
"9780930289232"
],
"title": "Watchmen",
"isbn_10": [
"0930289234"
],
"publish_date": "April 1, 1995",
"physical_dimensions": "10.1 x 6.6 x 0.8 inches"
};
validate(bookInfoSchema, bookInfo);
// → true
Theo I see why they call it allOf and anyOf. The first one means that data must con-
form to all the schemas, and the second one means that data must conform to
any of the schemas.
Joe Yup.
 NOTE JSON Schema also supports oneOf for cases where data must be valid against
exactly one schema.
Theo Nice. With schema composition, JSON Schema seems to have more expressive
power than what I was used to when representing data with classes.
Joe That’s only the beginning. I’ll show you more data validation conditions that
can’t be expressed when data is represented with classes some other time.
 NOTE Advanced data validation is covered in chapter 12.
Theo Something still bothers me, though. When data isn’t valid, you don’t know what
went wrong.

--- 페이지 185 끝 ---


--- 페이지 186 ---

158 CHAPTER 7 Basic data validation
7.5 Details about data validation failures
Joe So far, we’ve treated JSON Schema validation as though it were binary: either a
piece of data is valid or it isn’t.
Theo Right...
Joe But, in fact, when a piece of data is not valid, we can get details about the
reason of the invalidity.
Theo Like when a required field is missing, can we get the name of the missing field?
Joe Yes. When a piece of data is not of the expected type, we can get information
about that also.
Theo That sounds very useful!
Joe Indeed. Let me show you how it works. Until now, we used a generic validate
function, but when we deal with validation failures, we need to be more specific.
Theo Why?
Joe Because each data validator library has its own way of exposing the details of
adata validation failure. For instance, in JavaScript Ajv, the errors from the
last data validation are stored as an array inside the validator instance.
Theo Why an array?
Joe Because there could be several failures. But let’s start with the case of a single
failure. Imagine we encounter a search book request where the title field is
named myTitle instead of title. Take a look at this example. As you can see,
we first instantiate a validator instance.
Listing7.20 Accessing validation errors in Ajv
var searchBooksRequestSchema = {
"type": "object",
"properties": {
"title": {"type": "string"},
"fields": {
"type": "array",
"items": {"type": "string"}
}
},
"required": ["title", "fields"]
};
var invalidSearchBooksRequest = {
"myTitle": "habit",
"fields": ["title", "weight", "number_of_pages"]
};
Instantiates a
var ajv = new Ajv(); validator instance
ajv.validate(searchBooksRequestSchema, invalidSearchBooksRequest);
ajv.errors
Displays the
validation errors

--- 페이지 186 끝 ---
