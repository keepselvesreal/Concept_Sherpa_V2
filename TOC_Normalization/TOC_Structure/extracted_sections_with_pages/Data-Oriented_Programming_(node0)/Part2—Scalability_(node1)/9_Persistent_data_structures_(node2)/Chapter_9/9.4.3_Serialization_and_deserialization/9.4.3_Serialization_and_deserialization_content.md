# 9.4.3 Serialization and deserialization

**페이지**: 218-219
**계층**: Data-Oriented Programming (node0) > Part2—Scalability (node1) > 9 Persistent data structures (node2) > Chapter 9
**추출 시간**: 2025-08-06 19:47:08

---


--- 페이지 218 ---

190 CHAPTER 9 Persistent data structures
return Immutable.get(book, "title").
toLowerCase().
includes(queryLowerCased);
});
var bookInfos = Immutable.map(matchingBooks, function(book) {
return Catalog.bookInfo(catalogData, book);
});
return bookInfos;
}
}
Listing9.14 Testing book search with persistent data structures
var catalogData = Immutable.fromJS({
"booksByIsbn": {
"978-1779501127": {
"isbn": "978-1779501127",
"title": "Watchmen",
"publicationYear": 1987,
"authorIds": ["alan-moore",
"dave-gibbons"]
}
},
"authorsById": {
"alan-moore": {
"name": "Alan Moore",
"bookIsbns": ["978-1779501127"]
},
"dave-gibbons": {
"name": "Dave Gibbons",
"bookIsbns": ["978-1779501127"]
}
}
});
var bookInfo = Immutable.fromJS({
"isbn": "978-1779501127",
"title": "Watchmen",
"authorNames": ["Alan Moore",
"Dave Gibbons"]
});
Immutable.isEqual(
Catalog.searchBooksByTitle(catalogData, "Watchmen"),
Immutable.fromJS([bookInfo]));
// → true
Immutable.isEqual(
Catalog.searchBooksByTitle(catalogData, "Batman"),
Immutable.fromJS([]));
// → true

--- 페이지 218 끝 ---


--- 페이지 219 ---

9.4 Persistent data structures in action 191
9.4.2 Writing mutations with persistent data structures
Theo Shall we move forward and port the add member mutation?
Joe Sure. Porting the add member mutation from Lodash to Immutable.js only
requires you to again replace the underscore (_) with Immutable. Let’s look at
some code.
Listing9.15 Implementing member addition with persistent data structures
UserManagement.addMember = function(userManagement, member) {
var email = Immutable.get(member, "email");
var infoPath = ["membersByEmail", email];
if(Immutable.hasIn(userManagement, infoPath)) {
throw "Member already exists.";
}
var nextUserManagement = Immutable.setIn(userManagement,
infoPath,
member);
return nextUserManagement;
};
Theo So, for the tests, I’d convert the JavaScript objects to Immutable.js objects with
Immutable.fromJS(). How does this look?
Listing9.16 Testing member addition with persistent data structures
var jessie = Immutable.fromJS({
"email": "jessie@gmail.com",
"password": "my-secret"
});
var franck = Immutable.fromJS({
"email": "franck@gmail.com",
"password": "my-top-secret"
});
var userManagementStateBefore = Immutable.fromJS({
"membersByEmail": {
"franck@gmail.com": {
"email": "franck@gmail.com",
"password": "my-top-secret"
}
}
});
var expectedUserManagementStateAfter = Immutable.fromJS({
"membersByEmail": {
"jessie@gmail.com": {
"email": "jessie@gmail.com",
"password": "my-secret"
},
"franck@gmail.com": {
"email": "franck@gmail.com",
"password": "my-top-secret"

--- 페이지 219 끝 ---
