# 12.5 Automatic generation of schema-based unit tests

**페이지**: 290-292
**계층**: Data-Oriented Programming (node0) > Part3—Maintainability (node1) > 12 Advanced data validation (node2) > Chapter 12
**추출 시간**: 2025-08-06 19:47:18

---


--- 페이지 290 ---

262 CHAPTER 12 Advanced data validation
C Entity1
booksByIsbn: {Entity2}
authorsById: {Entity3}
C Entity2 C Entity4
title : String id: String
publicationYear: Number name: String
isbn: String booklsbns: [String]
authorlds: [String]
bookltems: [Entity3]
C Entity3
id: String
libld: String
Figure 12.2 A visualization of
purchaseDate: String
the PlantUML diagram generated
isLent: Boolean
from the catalog data schema
Dave That’s cool! But why are the diagram entities named Entity1, Entity2, and
so on?
Joe Because in JSON Schema, there’s no way to give a name to a schema. Malli has
to autogenerate random names for you.
Theo Also, I see that the extra information we have in the schema, like the number
range for publicationYear and string regular expression for isbn, is missing
from the diagram.
Joe Right, that extra information is not part of the data model. That’s why it’s not
included in the generated data model diagram.
Dave Anyway, it’s very cool!
Joe If you guys like the data model generation feature, I’m sure you’re going to
like the next feature.
Dave What’s it about?
Joe Automatic generation of unit tests.
Theo Wow, sounds exciting!
12.5 Automatic generation of schema-based unit tests
Joe Once you’ve defined a data schema for function arguments and for its return
value, it’s quite simple to generate a unit test for this function.
Dave How?
Joe Well, think about it. What’s the essence of a unit test for a function?
Dave A unit test calls a function with some arguments and checks whether the func-
tion returns the expected value.
Joe Exactly! Now, let’s adapt it to the context of data schema and DOP. Let’s say you
have a function with a schema for their arguments and for their return value.

--- 페이지 290 끝 ---


--- 페이지 291 ---

12.5 Automatic generation of schema-based unit tests 263
Dave OK.
Joe Here’s the flow of a schema-based unit test. We call the function with random
arguments that conform to the schema of the function arguments. Then, we
check whether the function returns a value that conforms to the schema of the
return value. Here, let me diagram it.
Joe goes to the whiteboard. He draws the diagram in figure 12.3.
Generaterandom datathat conforms toinput schema
Execute the function The input
is random.
Yes No
Output conforms to output schema
Test passes Test fails
Figure 12.3 The flow of
a schema-based unit test
Dave How do you generate random data that conforms to a schema?
Joe Using a tool like JSON Schema Faker. For example, let’s start with a simple
schema: the schema for a UUID. Let me show you how to generate random
data that conforms to the schema.
 NOTE You’ll find more information about JSON Schema Faker at https://github
.com/json-schema-faker/json-schema-faker.
Joe types on the keyboard for a bit. He then shows the code to generate random data to
Dave and Theo.
Listing12.19 Generating random data that conforms to a UUID schema
var uuidSchema = {
"type": "string",
"pattern": "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}" +
"-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
};
JSONSchemaFaker.generate(uuidSchema);
// → "7aA8CdF3-14DF-9EF5-1A19-47dacdB16Fa9"
Dave executes the code snippet a couple of times, and indeed, on each evaluation, it returns
a different UUID.
Dave Very cool! Let me see how it works with more complex schemas like the cata-
log schema.

--- 페이지 291 끝 ---


--- 페이지 292 ---

264 CHAPTER 12 Advanced data validation
When Dave calls JSONSchemaFaker.generate with the catalog schema, he gets some
quite long random data. He’s a bit surprised by the results.
Listing12.20 Generating random data that conforms to the catalog schema
{
"booksByIsbn": {
"Excepteur7": {
"title": "elit veniam anim",
"isbn": "5419903-3563-7",
"authorIds": [
"vfbzqahmuemgdegkzntfhzcjhjrbgfoljfzogfuqweggchum",
"inxmqh-",
],
"bookItems": {
"ullamco5": {
"id": "f7dac8c3-E59D-bc2E-7B33-C27F3794E2d6",
"libId": "4jtbj7q7nrylfu114m",
"purchaseDate": "2001-08-01",
"isLent": false
},
"culpa_3e": {
"id": "423DCdDF-CDAe-2CAa-f956-C6cd9dA8054b",
"libId": "6wcxbh",
"purchaseDate": "1970-06-24",
"isLent": true
}
},
"publicationYear": 1930,
"publisher": "sunt do nisi"
},
"aliquip_d7": {
"title": "aute",
"isbn": "348782167518177",
"authorIds": ["owfgtdxjbiidsobfgvjpjlxuabqpjhdcqmmmrjb-ezrsz-u"],
"bookItems": {
"ipsum__0b": {
"id": "6DfE93ca-DB23-5856-56Fd-82Ab8CffEFF5",
"libId": "bvjh0p2p2666vs7dd",
"purchaseDate": "2018-03-30",
"isLent": false
}
},
"publisher": "ea anim ut ex id",
"publicationYear": 1928
}
},
"authorsById": {
"labore_b88": {
"id": "adipisicing nulla proident",
"name": "culpa in minim",
"bookIsbns": [
"6243029--7",
"5557199424742986"
]

--- 페이지 292 끝 ---
