# 14.2 Manipulating nested data

**페이지**: 328-329
**계층**: Data-Oriented Programming (node0) > Part3—Maintainability (node1) > 14 Advanced data manipulation (node2) > Chapter 14
**추출 시간**: 2025-08-06 19:47:23

---


--- 페이지 328 ---

300 CHAPTER 14 Advanced data manipulation
Listing14.5 Retrieving the author IDs in books as an array of arrays
function authorIdsInBooks(books) {
return _.map(books, "authorIds");
}
Theo What’s the problem?
Dave The problem is that it returns an array of arrays of author IDs instead of an
array of author IDs. For instance, when I run authorIdsInBooks on a catalog
with two books, I get this result.
Listing14.6 The author IDs in an array of arrays
[
["sean-covey", "stephen-covey"],
["alan-moore", "dave-gibbons"]
]
Theo That’s not a big problem. You can flatten an array of arrays with _.flatten,
and you should get the result you expect.
Dave Nice! This is exactly what I need! Give me a moment to fix the code of
authorIdsInBooks. . . here you go.
Listing14.7 Retrieving the author IDs in books as an array of strings
function authorIdsInBooks(books) {
return _.flatten(_.map(books, "authorIds"));
}
Theo Don’t you think that mapping and then flattening deserves a function of its own?
Dave Maybe. It’s quite easy to implement a flatMap function.2 How about this?
Listing14.8 The implementation of flatMap
function flatMap(coll, f) {
return _.flatten(_.map(coll,f));
}
Theo Nice!
Dave I don’t know.... It’s kind of weird to have such a small function.
Theo I don’t think that code size is what matters here.
Dave What do you mean?
Theo See what happens when you rewrite authorIdsInBooks using flatMap.
Dave OK, here’s how I’d use flatMap to list the author IDs.
2 Lodash provides an implementation of flatMap, but for the sake of teaching, we are writing our own
implementation.

--- 페이지 328 끝 ---


--- 페이지 329 ---

14.3 Using the best tool for the job 301
Listing14.9 Retrieving the author IDs as an array of strings using flatMap
function authorIdsInBooks(books) {
return flatMap(books, "authorIds");
}
Theo What implementation do you prefer, the one with flatten and map (in listing
14.7) or the one with flatMap (in listing 14.9)?
Dave I don’t know. To me, they look quite similar.
Theo Right, but which implementation is more readable?
Dave Well, assuming I know what flatMap does, I would say the implementation
with flatMap. Because it’s more concise, it is a bit more readable.
Theo Again, it’s not about the size of the code. It’s about the clarity of intent and the
power of naming things.
Dave I don’t get that.
Theo Let me give you an example from our day-to-day language.
Dave OK.
Theo Could you pass me that thing on your desk that’s used for writing?
It takes Dave a few seconds to get that Theo has asked him to pass the pen on the desk.
After he passes Theo the pen, he asks:
Dave Why didn’t you simply ask for the pen?
Theo I wanted you to experience how it feels when we use descriptions instead of
names to convey our intent.
Dave Oh, I see. You mean that once we use a name for the operation that maps and
flattens, the code becomes clearer.
Theo Exactly.
Dave Let’s move on to the second admin feature: calculating the book lending ratio.
Theo Before that, I think we deserve a short period for rest and refreshments, where
we drink a beverage made by percolation from roasted and ground seeds.
Dave A coffee break!
14.3 Using the best tool for the job
After the coffee break, Dave shows Theo his implementation of the book lending ratio cal-
culation. This time, he seems to like the code he wrote.
Dave I’m quite proud of the code I wrote to calculate the book lending ratio.
Theo Show me the money!
Dave My function receives a list of books from the database like this.
Listing14.10 A list of two books with bookItems
[
{
"isbn": "978-1779501127",

--- 페이지 329 끝 ---
