# 13.5 Integrating multimethods in a production system

**페이지**: 315-317
**계층**: Data-Oriented Programming (node0) > Part3—Maintainability (node1) > 13 Polymorphism (node2) > Chapter 13
**추출 시간**: 2025-08-06 19:47:21

---


--- 페이지 315 ---

13.4 Multimethods with dynamic dispatch 287
Listing13.18 A multimethod using a dispatch function with dynamic dispatch
function dysGreetDispatch(animal) {
if(dev()) {
if(!ajv.validate(animalSchema, animal)) {
var errors = ajv.errorsText(ajv.errors);
throw ("dysGreet called with invalid arguments: " + errors);
}
}
var hasLongName = animal.name.length > 5;
return [animal.type, hasLongName];
};
var dysGreet = multi(dysGreetDispatch);
Dave Writing the dysGreet methods doesn’t seem too complicated.
As Theo reaches over to pass Dave his notebook, he accidently hits his coffee cup. Now Theo’s
notebook is completely wet, and all the diagrams are soggy! Fortunately, Dave brought an
extra napkin from the kitchen, and it’s still clean. He draws a flow diagram as in figure 13.4
and then grabs his laptop and writes the implementation of the dysGreet methods.
["dog", true] dysGreetDogLong
Greet as a dog mentioning name
["cat", true] dysGreetCatLong
Greet as a cat mentioning name
["cow", true] dysGreetCowLong
Greet as a cow mentioning name
args dysGreetLangDispatch
animal, language Emit the animal and the language types
["dog", false] dysGreetDogShort
Greet as a dog omitting name
["cat", false] dysGreetCatShort
Greet as a cat omitting name
["cow", false] dysGreetCowShort
Greet as a cow omitting name
Figure 13.4 The logic flow of the dysGreet multimethod
Listing13.19 The dysGreet methods
function dysGreetDogLong(animal) {
console.log("Woof woof! My name is " + animal.name);
}
dysGreet = method(["dog", true], dysGreetDogLong)(dysGreet);

--- 페이지 315 끝 ---


--- 페이지 316 ---

288 CHAPTER 13 Polymorphism
function dysGreetDogShort(animal) {
console.log("Woof woof!");
}
dysGreet = method(["dog", false], dysGreetDogShort)(dysGreet);
function dysGreetCatLong(animal) {
console.log("Meow! I am " + animal.name);
}
dysGreet = method(["cat", true], dysGreetCatLong)(dysGreet);
function dysGreetCatShort(animal) {
console.log("Meow!");
}
dysGreet = method(["cat", false], dysGreetCatShort)(dysGreet);
function dysGreetCowLong(animal) {
console.log("Moo! Call me " + animal.name);
}
dysGreet = method(["cow", true], dysGreetCowLong)(dysGreet);
function dysGreetCowShort(animal) {
console.log("Moo!");
}
dysGreet = method(["cow", false], dysGreetCowShort)(dysGreet);
Theo checks that the code works as expected. He compliments Dave, not only on the
method implementation but also for having the foresight to grab an extra napkin.
Listing13.20 Testing dysGreet
dysGreet(myDog);
dysGreet(myCow);
dysGreet(myCat);
//"Woof woof!"
//"Moo! Call me Clarabelle"
//"Meow!"
Theo Well done, my friend! Our exploration of multimethods has come to an end. I
think it’s time for me to drive back if I want to get home before dark and beat
the rush hour traffic.
Dave Before you leave, let’s check if multimethods are available in programming
languages other than JavaScript.
Theo That’s a question for Joe.
Dave Do you think it’s OK if I call him now?
Theo I think it’s probably better if you send him an email. He’s in a tech conference,
and I’m not sure if it’s all day. Thank you for this beautiful day in the country
and the wonderful refreshments.
Dave I enjoyed it, also, especially our discussions about etymology. I think there are
some oranges for you to take home and enjoy later.
Theo Great! I can’t wait until my wife tries one.

--- 페이지 316 끝 ---


--- 페이지 317 ---

13.5 Integrating multimethods in a production system 289
After Theo leaves, Dave sends Joe an email. A few minutes later, Dave receives an email
from Joe with the subject, “Support for multimethods in different languages.”
Support for multimethods in different languages
Python has a library called multimethods (https://github.com/weissjeffm/multimeth-
ods), and Ruby has one called Ruby multimethods (https://github.com/psantacl/
ruby-multimethods). Both seem to work quite like the JavaScript arrows/multi-
method library.
In Java, there is the Java Multimethod Framework (http://igm.univ-mlv.fr/~forax/
works/jmmf/), and C# supports multimethods natively via the dynamic keyword.
However, in both Java and C#, multimethods work only with static data types and not
with generic data structures.
Generic data structure
Language URL
support
JavaScript https://github.com/caderek/arrows/tree/master/ Yes
packages/multimethod
Java http://igm.univ-mlv.fr/~forax/works/jmmf/ No
C# Native support No
Python https://github.com/weissjeffm/multimethods Yes
Ruby https://github.com/psantacl/ruby-multimethods Yes
13.5 Integrating multimethods in a production system
While Theo is driving back home, his thoughts take him back to the fresh air of the coun-
try. This pleasant moment is interrupted by a phone call from Nancy at Klafim.
Nancy How are you doing?
Theo Fine. I’m driving back from the countryside.
Nancy Cool. Are you available to talk about work?
Theo Sure.
Nancy I’d like to add a tiny feature to the catalog.
In the past, when Nancy qualified a feature as tiny, it scared Theo because tiny turned into
huge. What seemed easy to her always took him a surprising amount of time to develop.
But after refactoring the system according to DOP principles, now what seems tiny to
Nancy is usually quite easy to implement.
Theo What feature?
Nancy I’d like to allow librarians to view the list of authors, ordered by last name, in
two formats: HTML and Markdown.

--- 페이지 317 끝 ---
