# 13.4 Multimethods with dynamic dispatch

**페이지**: 312-314
**계층**: Data-Oriented Programming (node0) > Part3—Maintainability (node1) > 13 Polymorphism (node2) > Chapter 13
**추출 시간**: 2025-08-06 19:47:21

---


--- 페이지 312 ---

284 CHAPTER 13 Polymorphism
if(!ajv.validate(greetLangArgsSchema, [animal, language])) {
throw ("greetLang called with invalid arguments: " +
ajv.errorsText(ajv.errors));
}
}
return [animal.type, language.type];
};
var greetLang = multi(greetLangDispatch);
Dave Does the order of the elements in the array matter?
Theo It doesn’t matter, but it needs to be consistent with the wiring of the methods.
The implementation of greetLang would therefore look like this.
Listing13.16 The implementation of greetLang methods
function greetLangDogEn(animal, language) {
console.log("Woof woof! My name is " +
animal.name +
" and I speak " +
language.name);
}
greetLang = method(["dog", "en"], greetLangDogEn)(greetLang);
function greetLangDogFr(animal, language) {
console.log("Ouaf Ouaf! Je m'appelle " +
animal.name +
" et je parle " +
language.name);
}
greetLang = method(["dog", "fr"], greetLangDogFr)(greetLang);
function greetLangCatEn(animal, language) {
console.log("Meow! I am " +
animal.name +
" and I speak " +
language.name);
}
greetLang = method(["cat", "en"], greetLangCatEn)(greetLang);
function greetLangCatFr(animal, language) {
console.log("Miaou! Je m'appelle " +
animal.name +
" et je parle " +
language.name);
}
greetLang = method(["cat", "fr"], greetLangCatFr)(greetLang);
function greetLangCowEn(animal, language) {
console.log("Moo! Call me " +
animal.name +
" and I speak " +

--- 페이지 312 끝 ---


--- 페이지 313 ---

13.3 Multimethods with multiple dispatch 285
language.name);
}
greetLang = method(["cow", "en"], greetLangCowEn)(greetLang);
function greetLangCowFr(animal, language) {
console.log("Meuh! Appelle moi " +
animal.name +
" et je parle " +
language.name);
}
greetLang = method(["cow", "fr"], greetLangCowFr)(greetLang);
Dave looks at the code for the methods that deal with French. He is surprised to see Ouaf
Ouaf instead of Woof Woof for dogs, Miaou instead of Meow for cats, and Meuh instead of
Moo for cows.
Dave I didn’t know that animal onomatopoeia were different in French than in
English!
Theo Ono what?
Dave Onomatopoeia, from the Greek ónoma that means name and poiéo– that means to
produce. It is the property of words that sound like what they represent; for
instance, Woof, Meow, and Moo.
Theo Yeah, for some reason in French, dogs Ouaf, cats Miaou, and cows Meuh.
Dave I see that in the array the animal type is always before the language type.
Theo Right! As I told you before, in a multimethod that features multiple dispatch,
the order doesn’t really matter, but it has to be consistent.
TIP Multiple dispatch is when a dispatch function emits a value that depends on more
than one argument. In a multimethod that features multiple dispatch, the order of
the elements in the array emitted by the dispatch function has to be consistent with
the order of the elements in the wiring of the methods.
Dave Now let me see if I can figure out how to use a multimethod that features mul-
tiple dispatch.
Dave remembers that Theo told him earlier that multimethods are used like regular func-
tions. With that in mind, he comes up with the code for a multimethod that features multi-
ple dispatch.
Listing13.17 Calling a multimethod that features multiple dispatch
greetLang(myDog, french);
// → "Ouaf Ouaf! Je m\'appelle Fido et je parle Français"
greetLang(myDog, english);
// → "Woof woof! My name is Fido and I speak English"
greetLang(myCat, french);
// → "Miaou! Je m\'appelle Milo et je parle Français"

--- 페이지 313 끝 ---


--- 페이지 314 ---

286 CHAPTER 13 Polymorphism
greetLang(myCat, english);
// → "Meow! I am Milo and I speak English"
greetLang(myCow, french);
// → "Meuh! Appelle moi Clarabelle et je parle Français"
greetLang(myCow, english);
// → "Moo! Call me Clarabelle and I speak English"
Theo Now do you agree that multimethods with multiple dispatch offer a more pow-
erful polymorphism that OOP polymorphism?
Dave Indeed, I do.
Theo Let me show you an even more powerful polymorphism called dynamic dis-
patch. But first, let’s get some more of that wonderful French press coffee.
Dave Great idea! While we’re in the kitchen, I think my mom made an orange Bundt
cake using the oranges from the grove.
13.4 Multimethods with dynamic dispatch
Dave refills their coffee cups as Theo takes two slices from the cake and dishes them up.
They take their coffee and cake outside to enjoy more of the fresh country air before
resuming their conversation.
Dave What is dynamic dispatch?
Theo It’s when the dispatch function of a multimethod returns a value that goes
beyond the static type of its arguments.
Dave Like what, for example?
Theo Like a number or a Boolean, for instance.
Dave Why would such a thing be useful?
Theo Imagine that instead of being polyglot, our animals would suffer from
dysmakrylexia.
Dave Suffering from what?
Theo Dysmakrylexia. It comes from the Greek dus, expressing the idea of difficulty,
makrýs meaning long, and léxis meaning diction. Therefore, dysmakrylexia is dif-
ficulty pronouncing long words.
Dave I’ve never heard of that.
Theo That’s because I just invented it.
Dave Funny. What’s considered a long word for our animals?
Theo Let’s say that when their name has more than five letters, they’re not able to
say it.
Dave A bit weird, but OK.
Theo Let’s call our multimethod dysGreet. Its dispatch function returns an array
with two elements: the animal type and a Boolean about whether the name is
long or not. Take a look at this multimethod initialization.

--- 페이지 314 끝 ---
